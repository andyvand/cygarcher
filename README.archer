more constification, based on Pedro's branch
